@inject Radzen.DialogService dialogService
@inject NotificationService notificationService
@inject AuthenticationStateProvider AuthenticationStateProvider
@using DAL = MOO.DAL.ToLive



<div class="row">
    <div class="col-12 mb-2">
        <h6>Factor:</h6>
        @EditFactorHist.Met_Factor.Description
    </div>
</div>
<div class="row mb-2">
    <div class="col-12">
        <h6>Date:</h6>
        <RadzenDatePicker @bind-Value=@EditFactorHist.Effective_Date DateFormat="d" Required="true" Disabled=@(!IsInsert) />
    </div>
</div>
<div class="row">
    <div class="col-12">
        <h6>Factor Value:</h6>
         <RadzenNumeric ShowUpDown="false" TValue="decimal" @bind-Value=@EditFactorHist.Factor_Value />
    </div>
</div>
<div class="col-md-12 text-right mt-4">
    <RadzenButton Icon="done" Text="save" Click="OkBtnClick" />
    <RadzenButton ButtonStyle="ButtonStyle.Secondary" Icon="cancel" Text="Cancel" Click="@((args) => dialogService.Close(false))" />
</div>

@code {
         /*
         * This dialog will be used for the Met Entry forms for changing the date
    */
    [Parameter] public DAL.Models.Met_Factor_History EditFactorHist { get; set; } = new();
    [Parameter] public bool IsInsert { get; set; } = new();


    private async Task OkBtnClick()
    {
        if (ValidateSelection())
        {
            
            if (IsInsert)
                await Task.Run(() => DAL.Services.Met_Factor_HistorySvc.Insert(EditFactorHist));
            else
                await Task.Run(() => DAL.Services.Met_Factor_HistorySvc.Update(EditFactorHist));
            dialogService.Close(true);
        }
    }

    private bool ValidateSelection()
    {
        if(EditFactorHist.Effective_Date > DateTime.Today.AddDays(30)){
            notificationService.Notify(new NotificationMessage()
                {
                    Severity = NotificationSeverity.Warning,
                    Summary = "Invalid Date Selected",
                    Detail = "Cannot insert date more than 30 days into future",
                    Duration = 4000
                });
            return false;
        }

        return true;
    }

}
